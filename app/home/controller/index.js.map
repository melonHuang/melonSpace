{
    "version": 3,
    "sources": [
        "../../../src/home/controller/index.js"
    ],
    "names": [
        "indexAction",
        "model",
        "getOptions",
        "frontPage",
        "get",
        "action",
        "rssAction",
        "getPostRssList",
        "list",
        "assign",
        "Date",
        "toString",
        "type",
        "display",
        "HOME_VIEW_PATH",
        "sitemapAction",
        "getPostSitemapList",
        "installAction",
        "isGet",
        "firekylin",
        "isInstalled",
        "redirect",
        "fail",
        "errors",
        "think",
        "isEmpty",
        "data",
        "post",
        "dbInfo",
        "host",
        "db_host",
        "port",
        "db_port",
        "database",
        "db_name",
        "user",
        "db_account",
        "password",
        "db_password",
        "prefix",
        "db_table_prefix",
        "account",
        "username",
        "InstallService",
        "service",
        "instance",
        "ip",
        "message",
        "run",
        "catch",
        "err",
        "contributorAction",
        "options",
        "hasOwnProperty",
        "push",
        "USER_CONTRIBUTOR",
        "status",
        "USER_DISABLED",
        "create_time",
        "datetime",
        "last_login_time",
        "create_ip",
        "last_login_ip",
        "where",
        "name",
        "email",
        "_logic",
        "thenAdd"
    ],
    "mappings": "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",
    "file": "../../../src/home/controller/index.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\n\nexport default class extends Base {\n  /**\n   * 首页如果设置了自定义首页则渲染对应页面\n   * @return {[type]} [description]\n   */\n  async indexAction(){\n    let {frontPage} = await this.model('options').getOptions();\n    if( frontPage ) {\n      this.get('pathname', frontPage);\n      return this.action('post', 'page');\n    }\n\n    return this.action('post', 'list');\n  }\n  /**\n   * rss\n   * @return {[type]} [description]\n   */\n  async rssAction(){\n    let model = this.model('post');\n    let list = await model.getPostRssList();\n    this.assign('list', list);\n    this.assign('currentTime', (new Date()).toString());\n\n    this.type('text/xml');\n    return super.display(this.HOME_VIEW_PATH + 'rss.xml');\n  }\n\n  /**\n   * sitemap action\n   * @return {[type]} [description]\n   */\n  async sitemapAction(){\n    let model = this.model('post');\n    let list = model.getPostSitemapList();\n    this.assign('list', list);\n\n    this.type('text/xml');\n    return this.display(this.HOME_VIEW_PATH + 'sitemap.xml');\n  }\n  /**\n   * install\n   * @return {[type]} [description]\n   */\n  async installAction(){\n    if(this.isGet()){\n      if(firekylin.isInstalled){\n        return this.redirect('/');\n      }\n      return this.display();\n    }\n    if(firekylin.isInstalled){\n      return this.fail('SYSTERM_INSTALLED');\n    }\n\n    let errors = this.assign('errors');\n    if(!think.isEmpty(errors)){\n      this.assign('message', errors[Object.keys(errors)[0]]);\n      return this.display();\n    }\n\n    let data = this.post();\n    let dbInfo = {\n      host: data.db_host,\n      port: data.db_port,\n      database: data.db_name,\n      user: data.db_account,\n      password: data.db_password,\n      prefix: data.db_table_prefix\n    }\n    let account = {\n      username: data.username,\n      password: data.password\n    }\n    let InstallService = this.service('install');\n    let instance = new InstallService(dbInfo, account, this.ip());\n    let message = 'success';\n    await instance.run().catch(err => {\n      message = err;\n    });\n    this.assign('message', message);\n    this.assign('data', data);\n    this.display();\n  }\n  /**\n   * 申请成为投稿者\n   * @return {[type]} [description]\n   */\n  async contributorAction() {\n    if( !this.options.hasOwnProperty('push') || this.options.push == 0) {\n      return this.fail('PUSH_CLOSED');\n    }\n    if( this.isGet() ) {\n      return this.display();\n    }\n\n    let user = this.post();\n    user.type = firekylin.USER_CONTRIBUTOR;\n    user.status = firekylin.USER_DISABLED;\n    user.create_time = think.datetime();\n    user.last_login_time = user.create_time;\n    user.create_ip = this.ip();\n    user.last_login_ip = this.ip();\n\n    await this.model('user').where({name: user.name, email: user.email, _logic: 'OR'}).thenAdd(user);\n    this.assign('message', 'success');\n    this.display();\n  }\n}\n"
    ]
}